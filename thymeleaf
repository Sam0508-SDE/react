<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Batch Job Dashboard</title>
    <link rel="stylesheet" href="/static.css/bootstrap.min.css">
    <style>
        body { padding: 20px; }
        .badge { padding: 0.5em 0.75em; font-size: 0.9em; }
    </style>
</head>
<body>
<div class="container">
    <h2 class="mb-4">ðŸ“Š Batch Job Dashboard</h2>

    <table class="table table-bordered table-striped">
        <thead class="table-dark">
        <tr>
            <th>Instance ID</th>
            <th>Job Name</th>
            <th>Execution ID</th>
            <th>Status</th>
            <th>Exit Code</th>
            <th>Start Time</th>
            <th>End Time</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="exec : ${instanceList}">
            <td th:text="${exec.instanceId}">Instance ID</td>
            <td th:text="${exec.jobName}">Job Name</td>
            <td th:text="${exec.executionId}">Execution ID</td>
            <td>
                <span class="badge"
                      th:classappend="${exec.status} == 'COMPLETED' ? 'bg-success' :
                                      (${exec.status} == 'FAILED' ? 'bg-danger' :
                                      (${exec.status} == 'STARTED' ? 'bg-primary' : 'bg-warning'))"
                      th:text="${exec.status}">Status</span>
            </td>
            <td th:text="${exec.exitCode}">Exit Code</td>
            <td th:text="${#dates.format(exec.startTime, 'yyyy-MM-dd HH:mm:ss')}">Start</td>
            <td th:text="${exec.endTime != null ? #dates.format(exec.endTime, 'yyyy-MM-dd HH:mm:ss') : '-'}">End</td>
            <td>
                <form th:action="@{'/job/stop/' + ${exec.executionId}}" method="post">
                    <button type="submit" class="btn btn-sm btn-outline-danger"
                            th:disabled="${exec.status != 'STARTED' and exec.status != 'STARTING'}">
                        Stop
                    </button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>

    <hr>

    <h4>ðŸš€ Launch New Batch Job</h4>
    <form th:action="@{/job/update-key}" method="post" class="mt-3">
        <div class="mb-3">
            <label>Table Name</label>
            <input type="text" name="tableName" class="form-control" required>
        </div>
        <div class="mb-3">
            <label>Source Column</label>
            <input type="text" name="sourceColumn" class="form-control" required>
        </div>
        <div class="mb-3">
            <label>Destination Column</label>
            <input type="text" name="destinationColumn" class="form-control" required>
        </div>
        <div class="mb-3">
            <label>Old Key</label>
            <input type="password" name="oldKey" class="form-control" required>
        </div>
        <div class="mb-3">
            <label>New Key</label>
            <input type="password" name="newKey" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-success">Start Job</button>
    </form>
</div>
</body>
</html>
