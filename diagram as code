---
config:
  layout: elk
---
flowchart LR
 subgraph qr_ui_group["qr ui"]
        svc_qr_ui["Service qr ui"]
        pod_qr_ui_1["Pod qr ui 1"]
        pod_qr_ui_2["Pod qr ui 2"]
  end
 subgraph gw_api_group["gw api"]
        svc_gw_api["Service gw api"]
        pod_gw_api_1["Pod gw api 1"]
        pod_gw_api_2["Pod gw api 2"]
  end
 subgraph qr_api_group["qr api"]
        svc_qr_api["Service qr api"]
        pod_qr_api_1["Pod qr api 1"]
        pod_qr_api_2["Pod qr api 2"]
  end
 subgraph k8s["RKE2 Kubernetes"]
        igw["Istio IngressGateway"]
        gw["Istio Gateway"]
        qr_ui_group
        gw_api_group
        qr_api_group
  end
    user["User"] --> f5["F5 WAF"]
    f5 --> igw
    igw --> gw
    gw --> svc_qr_ui
    svc_qr_ui --> pod_qr_ui_1 & pod_qr_ui_2
    svc_qr_ui -- calls --> svc_gw_api
    svc_gw_api -- post auth --> svc_qr_api
    svc_gw_api --> pod_gw_api_1 & pod_gw_api_2
    svc_qr_api --> pod_qr_api_1 & pod_qr_api_2






sequenceDiagram
    autonumber
    participant U as User (Browser)
    participant F5 as F5
    participant IGW as Ingress
    participant GW as Gateway
    participant UI as qr ui (Service)
    participant G as gw api
    participant A as qr api

    %% Initial page load
    U->>F5: GET /
    F5->>IGW: forward TLS
    IGW->>GW: route by host
    GW->>UI: / â†’ qr ui
    UI-->>U: HTML + JS + CSS

    %% Browser app now active
    note over U: Browser app makes API call
    U->>F5: GET /api/...
    F5->>IGW: forward TLS
    IGW->>GW: route /api/*
    GW->>G: gw api (auth check)
    G->>A: forward to qr api
    A-->>G: data
    G-->>U: JSON response
